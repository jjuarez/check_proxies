#!/usr/bin/env ruby


require 'net/http'
require 'uri'


if( __FILE__ == $0 )

  proxies_config_file = 'proxies.conf'
  url_check           = 'http://www.infojobs.net/'
  proxies_file_name   = File.join( File.dirname( __FILE__ ), '..', 'config', proxies_config_file )

  File.open( proxies_file_name ).each do |proxy|

    proxy_uri = URI.parse( "http://#{proxy}" )

    $stderr.puts( "Host:#{proxy_uri.host} Port:#{proxy_uri.port}" )

    begin
      Net::HTTP::Proxy( proxy_uri.host, proxy_uri.port ).start( url_check ) do |http|

        $stderr.puts( "Checking..." )
        $stderr.puts( "Proxy valido: #{proxy_uri}" ) if http.get == Net::HTTPSuccess
      end
    rescue => e
      $stderr.puts( e.message )
    end
  end
end